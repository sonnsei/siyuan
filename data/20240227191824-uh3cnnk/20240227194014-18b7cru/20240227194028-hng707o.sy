{"ID":"20240227194028-hng707o","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240227194028-hng707o","title":"堆外内存不足导致网络IO异常","updated":"20240227200858"},"Children":[{"ID":"20240227194043-k4zjlle","Type":"NodeParagraph","Properties":{"id":"20240227194043-k4zjlle"}},{"ID":"20240227194028-nkjq6qn","Type":"NodeParagraph","Properties":{"id":"20240227194028-nkjq6qn","updated":"20240227200338"},"Children":[{"Type":"NodeText","Data":"在32位的Windows环境中，理论上有4G的地址空间，Windows默认会分成2+2，分别给用户模式和内核模式，所以32位的程序理论上只有2G的地址空间。同时Windows有一个/3GB开关，打开后可以按3+1分配，此外在某些版本的Windows中，可以支持PAE（physical address extension）物理地址扩展，允许操作系统使用超过4G的物理内存，但是该特性需要硬件和操作系统的共同支持，并且对程序的兼容性可能有问题。大部分的32位处理器都是支持PAE的。具体来说，PAE 增加了额外的 4 条地址线，从而将物理地址的宽度扩展到 36 位，这允许处理器直接寻址高达 64GB（2^36 字节）的物理内存。操作系统通过使用更大的页表项（通常从 32 位增加到 64 位）来管理这些额外的地址线。"}]},{"ID":"20240227200339-d4knkvs","Type":"NodeParagraph","Properties":{"id":"20240227200339-d4knkvs","updated":"20240227200339"}},{"ID":"20240227200511-4mutame","Type":"NodeParagraph","Properties":{"id":"20240227200511-4mutame","updated":"20240227200737"},"Children":[{"Type":"NodeText","Data":"比如一个Java进程有2g的地址空间，xmx指定了900，虚拟机本身占用了500，剩下的非堆内存以及操作系统相关的共享600，这样非堆内存就被迫减小，而非堆内存不足会影响NIO性能，导致网络调用表现异常。"}]},{"ID":"20240227200738-yjy9t3f","Type":"NodeParagraph","Properties":{"id":"20240227200738-yjy9t3f","updated":"20240227200857"},"Children":[{"Type":"NodeText","Data":"在这个例子中，xmx设置为900时频繁出现网络超时，但是网络状况及云端服务响应速度都是正常的，问题就出在终端的网络请求发送和接收上，当调整xmx为768之后，问题得到明显改善。"}]},{"ID":"20240227200858-y9nirlt","Type":"NodeParagraph","Properties":{"id":"20240227200858-y9nirlt","updated":"20240227200858"}},{"ID":"20240227200858-gc94ndy","Type":"NodeParagraph","Properties":{"id":"20240227200858-gc94ndy","updated":"20240227200858"}},{"ID":"20240227200339-otj7uh4","Type":"NodeParagraph","Properties":{"id":"20240227200339-otj7uh4","updated":"20240227200339"}},{"ID":"20240227200328-9c93iu9","Type":"NodeParagraph","Properties":{"id":"20240227200328-9c93iu9","updated":"20240227200328"}},{"ID":"20240227200329-pq5eq07","Type":"NodeParagraph","Properties":{"id":"20240227200329-pq5eq07","updated":"20240227200329"}}]}